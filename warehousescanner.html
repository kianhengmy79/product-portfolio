<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Warehouse Scanner - Login</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
        }
        
        body {
            background: linear-gradient(135deg, #1a2a6c, #b21f1f, #fdbb2d);
            min-height: 100vh;
            display: flex;
            justify-content: center;
            align-items: center;
            padding: 20px;
        }
        
        .container {
            width: 100%;
            max-width: 1200px;
            background: rgba(255, 255, 255, 0.95);
            border-radius: 12px;
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.3);
            overflow: hidden;
            position: relative;
        }
        
        header {
            background: #1a2a6c;
            color: white;
            padding: 20px;
            text-align: center;
        }
        
        header h1 {
            font-size: 28px;
            margin-bottom: 5px;
        }
        
        /* Login Page Styles */
        #login-page {
            padding: 40px;
            text-align: center;
        }
        
        .login-form {
            max-width: 400px;
            margin: 0 auto;
            padding: 30px;
            background: white;
            border-radius: 10px;
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.1);
        }
        
        .login-form h2 {
            margin-bottom: 20px;
            color: #1a2a6c;
        }
        
        .form-group {
            margin-bottom: 20px;
            text-align: left;
        }
        
        .form-group label {
            display: block;
            margin-bottom: 8px;
            font-weight: 600;
            color: #333;
        }
        
        .form-group input {
            width: 100%;
            padding: 12px;
            border: 1px solid #ddd;
            border-radius: 6px;
            font-size: 16px;
        }
        
        .login-btn {
            width: 100%;
            padding: 12px;
            background: #1a2a6c;
            color: white;
            border: none;
            border-radius: 6px;
            font-size: 16px;
            font-weight: 600;
            cursor: pointer;
            transition: background 0.3s;
        }
        
        .login-btn:hover {
            background: #2a3a9c;
        }
        
        .demo-login {
            margin-top: 20px;
            display: flex;
            justify-content: space-between;
            gap: 10px;
        }
        
        .demo-btn {
            flex: 1;
            padding: 10px;
            background: #f5f5f5;
            border: 1px solid #ddd;
            border-radius: 6px;
            font-size: 14px;
            cursor: pointer;
            transition: background 0.3s;
        }
        
        .demo-btn:hover {
            background: #e5e5e5;
        }
        
        /* Main App Styles (initially hidden) */
        #main-app {
            display: none;
        }
        
        .app-container {
            display: flex;
            padding: 20px;
            gap: 20px;
        }
        
        .left-panel {
            flex: 1;
        }
        
        .right-panel {
            flex: 2;
        }
        
        .scanner-section {
            background: white;
            border-radius: 8px;
            padding: 20px;
            box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
            margin-bottom: 20px;
        }
        
        .camera-feed {
            width: 100%;
            height: 250px;
            background-color: #f0f0f0;
            border-radius: 8px;
            margin: 0 auto 15px;
            display: flex;
            justify-content: center;
            align-items: center;
            overflow: hidden;
            position: relative;
        }
        
        .camera-placeholder {
            font-size: 80px;
            color: #ccc;
        }
        
        .error-message {
            background: #ffebee;
            color: #c62828;
            padding: 15px;
            border-radius: 8px;
            margin: 15px 0;
            text-align: left;
            border-left: 4px solid #c62828;
        }
        
        .error-message h3 {
            margin-bottom: 10px;
            display: flex;
            align-items: center;
        }
        
        .error-icon {
            margin-right: 10px;
            font-size: 20px;
        }
        
        .controls {
            display: flex;
            flex-wrap: wrap;
            gap: 10px;
            margin: 15px 0;
        }
        
        button {
            padding: 10px 15px;
            border: none;
            border-radius: 6px;
            font-size: 14px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
        }
        
        .primary-btn {
            background: #1a2a6c;
            color: white;
        }
        
        .primary-btn:hover {
            background: #2a3a9c;
            transform: translateY(-2px);
        }
        
        .secondary-btn {
            background: #f5f5f5;
            color: #333;
            border: 1px solid #ddd;
        }
        
        .secondary-btn:hover {
            background: #e5e5e5;
        }
        
        .danger-btn {
            background: #d32f2f;
            color: white;
        }
        
        .danger-btn:hover {
            background: #c62828;
        }
        
        .troubleshooting {
            background: #e3f2fd;
            padding: 15px;
            border-radius: 8px;
            margin-top: 15px;
            text-align: left;
            border-left: 4px solid #2196f3;
        }
        
        .troubleshooting h3 {
            color: #1565c0;
            margin-bottom: 10px;
            display: flex;
            align-items: center;
        }
        
        .help-icon {
            margin-right: 10px;
            font-size: 20px;
        }
        
        .troubleshooting ol {
            padding-left: 20px;
            margin-bottom: 10px;
        }
        
        .troubleshooting li {
            margin-bottom: 8px;
            line-height: 1.5;
            font-size: 14px;
        }
        
        .scan-animation {
            position: absolute;
            height: 3px;
            width: 100%;
            background: linear-gradient(90deg, transparent, #4caf50, transparent);
            top: 50%;
            animation: scan 2s linear infinite;
            display: none;
        }
        
        @keyframes scan {
            0% { top: 20%; }
            100% { top: 80%; }
        }
        
        .mode-display {
            background: #e8f5e9;
            padding: 15px;
            border-radius: 8px;
            margin: 15px 0;
            text-align: center;
            border: 1px solid #c8e6c9;
        }
        
        .mode-indicator {
            display: inline-block;
            padding: 5px 10px;
            border-radius: 20px;
            font-weight: 600;
            margin-left: 10px;
        }
        
        .mode-in {
            background: #e8f5e9;
            color: #2e7d32;
            border: 1px solid #c8e6c9;
        }
        
        .mode-out {
            background: #ffebee;
            color: #c62828;
            border: 1px solid #ffcdd2;
        }
        
        .inventory-section {
            background: white;
            border-radius: 8px;
            padding: 20px;
            box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
        }
        
        .inventory-table {
            width: 100%;
            border-collapse: collapse;
            margin-top: 15px;
        }
        
        .inventory-table th, .inventory-table td {
            padding: 12px;
            text-align: left;
            border-bottom: 1px solid #ddd;
        }
        
        .inventory-table th {
            background-color: #f5f5f5;
            font-weight: 600;
        }
        
        .inventory-table tr:hover {
            background-color: #f9f9f9;
        }
        
        .export-section {
            background: white;
            border-radius: 8px;
            padding: 20px;
            box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
            margin-top: 20px;
        }
        
        .export-options {
            display: flex;
            gap: 10px;
            margin-top: 15px;
            flex-wrap: wrap;
        }
        
        .data-preview {
            background: #f9f9f9;
            border-radius: 8px;
            padding: 15px;
            margin-top: 15px;
            font-family: monospace;
            white-space: pre-wrap;
            max-height: 200px;
            overflow-y: auto;
        }
        
        .notification {
            position: fixed;
            top: 20px;
            right: 20px;
            padding: 15px;
            border-radius: 8px;
            background: #4caf50;
            color: white;
            box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
            display: none;
            z-index: 1000;
        }
        
        .user-info {
            position: absolute;
            top: 20px;
            right: 20px;
            display: flex;
            align-items: center;
            gap: 10px;
        }
        
        .logout-btn {
            padding: 8px 12px;
            background: #f5f5f5;
            border: 1px solid #ddd;
            border-radius: 6px;
            cursor: pointer;
            transition: background 0.3s;
        }
        
        .logout-btn:hover {
            background: #e5e5e5;
        }
    </style>
</head>
<body>
    <div class="container">
        <header>
            <h1>Warehouse Scanner Pro</h1>
            <p>Advanced inventory management with standardized data export</p>
        </header>
        
        <!-- Login Page (initially visible) -->
        <div id="login-page">
            <div class="login-form">
                <h2><i class="fas fa-lock"></i> Login to Warehouse Scanner</h2>
                <div class="form-group">
                    <label for="username">Username</label>
                    <input type="text" id="username" placeholder="Enter your username">
                </div>
                <div class="form-group">
                    <label for="password">Password</label>
                    <input type="password" id="password" placeholder="Enter your password">
                </div>
                <button class="login-btn" id="login-btn">Login</button>
                
                <div class="demo-login">
                    <button class="demo-btn" data-username="admin" data-password="admin123">
                        Login as Admin
                    </button>
                    <button class="demo-btn" data-username="manager" data-password="manager123">
                        Login as Manager
                    </button>
                    <button class="demo-btn" data-username="staff" data-password="staff123">
                        Login as Staff
                    </button>
                </div>
            </div>
        </div>
        
        <!-- Main App (initially hidden) -->
        <div id="main-app">
            <div class="user-info">
                <span id="user-display">Logged in as: Admin</span>
                <button class="logout-btn" id="logout-btn"><i class="fas fa-sign-out-alt"></i> Logout</button>
            </div>
            
            <div class="app-container">
                <div class="left-panel">
                    <div class="scanner-section">
                        <h2 class="text-xl font-bold mb-4"><i class="fas fa-barcode"></i> Barcode Scanner</h2>
                        
                        <div class="camera-feed">
                            <div class="camera-placeholder">
                                <i class="fas fa-camera"></i>
                            </div>
                            <div class="scan-animation"></div>
                            <div id="camera-error" class="error-message hidden">
                                <h3><i class="fas fa-exclamation-circle error-icon"></i> Camera Error</h3>
                                <p>Requested device not found. Please check your camera connection and permissions.</p>
                            </div>
                        </div>
                        
                        <div class="controls">
                            <button id="start-camera" class="primary-btn">
                                <i class="fas fa-play"></i> Start Camera
                            </button>
                            <button id="stop-camera" class="secondary-btn">
                                <i class="fas fa-stop"></i> Stop Camera
                            </button>
                            <button id="toggle-mode" class="primary-btn">
                                <i class="fas fa-exchange-alt"></i> Toggle Mode
                            </button>
                        </div>
                        
                        <div class="mode-display">
                            <h3 class="font-bold">Current Mode: <span id="mode-text">IN</span> <span class="mode-indicator mode-in">INBOUND</span></h3>
                            <p class="text-sm mt-1">Scanning barcodes will <span id="mode-action">increase</span> item quantities</p>
                        </div>
                        
                        <div class="controls">
                            <button id="manual-add" class="secondary-btn">
                                <i class="fas fa-plus-circle"></i> Add Item Manually
                            </button>
                            <button id="clear-data" class="danger-btn">
                                <i class="fas fa-trash"></i> Clear All Data
                            </button>
                        </div>
                        
                        <div class="troubleshooting">
                            <h3><i class="fas fa-tools help-icon"></i> Camera Troubleshooting</h3>
                            <ol>
                                <li>Check if your camera is connected properly</li>
                                <li>Ensure you've granted camera permissions for this site</li>
                                <li>Try refreshing the page and trying again</li>
                                <li>If using a mobile device, ensure no other app is using the camera</li>
                            </ol>
                            <button id="retry-camera" class="secondary-btn mt-2">
                                <i class="fas fa-sync-alt"></i> Retry Camera Connection
                            </button>
                        </div>
                    </div>
                    
                    <div class="export-section">
                        <h2 class="text-xl font-bold mb-4"><i class="fas fa-file-export"></i> Data Export</h2>
                        <p class="text-sm text-gray-600 mb-3">Export your inventory data in standardized CSV format</p>
                        
                        <div class="export-options">
                            <button id="export-csv" class="primary-btn">
                                <i class="fas fa-file-csv"></i> Export CSV
                            </button>
                            <button id="preview-data" class="secondary-btn">
                                <i class="fas fa-eye"></i> Preview Data
                            </button>
                        </div>
                        
                        <div class="data-preview hidden">
                            <h4 class="font-bold mb-2">Data Preview (Standardized Format):</h4>
                            <div id="preview-content"></div>
                        </div>
                    </div>
                </div>
                
                <div class="right-panel">
                    <div class="inventory-section">
                        <h2 class="text-xl font-bold mb-4"><i class="fas fa-boxes"></i> Current Inventory</h2>
                        
                        <div class="flex justify-between items-center mb-4">
                            <div class="flex items-center">
                                <span class="text-sm text-gray-600 mr-2">Search:</span>
                                <input type="text" id="search-inventory" placeholder="Barcode or name..." class="px-3 py-1 border rounded">
                            </div>
                            <span class="text-sm text-gray-600">Total Items: <span id="item-count">0</span></span>
                        </div>
                        
                        <table class="inventory-table">
                            <thead>
                                <tr>
                                    <th>Barcode</th>
                                    <th>Product Name</th>
                                    <th>Quantity</th>
                                    <th>Last Updated</th>
                                    <th>Actions</th>
                                </tr>
                            </thead>
                            <tbody id="inventory-body">
                                <tr>
                                    <td>10009901</td>
                                    <td>Wireless Headphones</td>
                                    <td>24</td>
                                    <td>10/15/2023 14:22</td>
                                    <td>
                                        <button class="text-blue-600 hover:text-blue-800">
                                            <i class="fas fa-edit"></i>
                                        </button>
                                        <button class="text-red-600 hover:text-red-800 ml-2">
                                            <i class="fas fa-trash"></i>
                                        </button>
                                    </td>
                                </tr>
                                <tr>
                                    <td>1000990340703</td>
                                    <td>Keyboard</td>
                                    <td>548</td>
                                    <td>10/16/2023 09:45</td>
                                    <td>
                                        <button class="text-blue-600 hover:text-blue-800">
                                            <i class="fas fa-edit"></i>
                                        </button>
                                        <button class="text-red-600 hover:text-red-800 ml-2">
                                            <i class="fas fa-trash"></i>
                                        </button>
                                    </td>
                                </tr>
                                <tr>
                                    <td>1000990720703</td>
                                    <td>USB-C Cable</td>
                                    <td>32</td>
                                    <td>10/14/2023 16:30</td>
                                    <td>
                                        <button class="text-blue-600 hover:text-blue-800">
                                            <i class="fas fa-edit"></i>
                                        </button>
                                        <button class="text-red-600 hover:text-red-800 ml-2">
                                            <i class="fas fa-trash"></i>
                                        </button>
                                    </td>
                                </tr>
                            </tbody>
                        </table>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <div class="notification" id="notification">
        <i class="fas fa-check-circle"></i> <span id="notification-text"></span>
    </div>

    <script>
        document.addEventListener('DOMContentLoaded', function() {
            // Login elements
            const loginPage = document.getElementById('login-page');
            const mainApp = document.getElementById('main-app');
            const loginBtn = document.getElementById('login-btn');
            const logoutBtn = document.getElementById('logout-btn');
            const usernameInput = document.getElementById('username');
            const passwordInput = document.getElementById('password');
            const demoBtns = document.querySelectorAll('.demo-btn');
            const userDisplay = document.getElementById('user-display');
            
            // Main app elements
            const startCameraBtn = document.getElementById('start-camera');
            const stopCameraBtn = document.getElementById('stop-camera');
            const toggleModeBtn = document.getElementById('toggle-mode');
            const retryCameraBtn = document.getElementById('retry-camera');
            const cameraError = document.getElementById('camera-error');
            const scanAnimation = document.querySelector('.scan-animation');
            const modeText = document.getElementById('mode-text');
            const modeAction = document.getElementById('mode-action');
            const modeIndicator = document.querySelector('.mode-indicator');
            const exportCsvBtn = document.getElementById('export-csv');
            const previewDataBtn = document.getElementById('preview-data');
            const previewContent = document.getElementById('preview-content');
            const dataPreview = document.querySelector('.data-preview');
            const notification = document.getElementById('notification');
            const notificationText = document.getElementById('notification-text');
            const manualAddBtn = document.getElementById('manual-add');
            const clearDataBtn = document.getElementById('clear-data');
            const searchInventory = document.getElementById('search-inventory');
            const itemCount = document.getElementById('item-count');
            const inventoryBody = document.getElementById('inventory-body');
            
            let isScanning = false;
            let isInMode = true;
            let lastScannedTime = 0;
            const scanCooldown = 2000; // 2 seconds cooldown between scans
            
            // Sample inventory data
            let inventoryData = [
                { barcode: "10009901", name: "Wireless Headphones", qty: 24, lastScan: "10/15/2023 14:22" },
                { barcode: "1000990340703", name: "Keyboard", qty: 548, lastScan: "10/16/2023 09:45" },
                { barcode: "1000990720703", name: "USB-C Cable", qty: 32, lastScan: "10/14/2023 16:30" },
                { barcode: "10774035", name: "Mouse Pad", qty: 15, lastScan: "10/13/2023 11:20" },
                { barcode: "4409940341703", name: "Webcam", qty: 8, lastScan: "10/12/2023 15:45" }
            ];
            
            // Login functionality
            function login(username, password) {
                // Simple authentication (in a real app, this would be server-side)
                const users = {
                    'admin': 'admin123',
                    'manager': 'manager123',
                    'staff': 'staff123'
                };
                
                if (users[username] && users[username] === password) {
                    // Successful login
                    loginPage.style.display = 'none';
                    mainApp.style.display = 'block';
                    userDisplay.textContent = `Logged in as: ${username.charAt(0).toUpperCase() + username.slice(1)}`;
                    showNotification('Login successful!');
                    
                    // Initialize the main app
                    renderInventory();
                } else {
                    // Failed login
                    showNotification('Invalid username or password', false);
                }
            }
            
            // Logout functionality
            function logout() {
                loginPage.style.display = 'block';
                mainApp.style.display = 'none';
                usernameInput.value = '';
                passwordInput.value = '';
                stopCamera();
            }
            
            // Show notification function
            function showNotification(message, isSuccess = true) {
                notification.style.backgroundColor = isSuccess ? '#4caf50' : '#d32f2f';
                notificationText.textContent = message;
                notification.style.display = 'block';
                
                setTimeout(() => {
                    notification.style.display = 'none';
                }, 3000);
            }
            
            // Update item count
            function updateItemCount() {
                itemCount.textContent = inventoryData.length;
            }
            
            // Render inventory table
            function renderInventory() {
                const searchTerm = searchInventory.value.toLowerCase();
                
                const filteredData = searchTerm ? 
                    inventoryData.filter(item => 
                        item.barcode.toLowerCase().includes(searchTerm) || 
                        item.name.toLowerCase().includes(searchTerm)
                    ) : inventoryData;
                
                inventoryBody.innerHTML = '';
                
                filteredData.forEach(item => {
                    const row = document.createElement('tr');
                    
                    row.innerHTML = `
                        <td>${item.barcode}</td>
                        <td>${item.name}</td>
                        <td>${item.qty}</td>
                        <td>${item.lastScan}</td>
                        <td>
                            <button class="text-blue-600 hover:text-blue-800 edit-btn" data-barcode="${item.barcode}">
                                <i class="fas fa-edit"></i>
                            </button>
                            <button class="text-red-600 hover:text-red-800 ml-2 delete-btn" data-barcode="${item.barcode}">
                                <i class="fas fa-trash"></i>
                            </button>
                        </td>
                    `;
                    
                    inventoryBody.appendChild(row);
                });
                
                // Add event listeners to edit and delete buttons
                document.querySelectorAll('.edit-btn').forEach(btn => {
                    btn.addEventListener('click', () => editItem(btn.dataset.barcode));
                });
                
                document.querySelectorAll('.delete-btn').forEach(btn => {
                    btn.addEventListener('click', () => deleteItem(btn.dataset.barcode));
                });
                
                updateItemCount();
            }
            
            // Edit item
            function editItem(barcode) {
                const item = inventoryData.find(i => i.barcode === barcode);
                if (item) {
                    const newName = prompt('Edit product name:', item.name);
                    if (newName !== null) {
                        item.name = newName;
                        renderInventory();
                        showNotification('Product updated successfully');
                    }
                }
            }
            
            // Delete item
            function deleteItem(barcode) {
                if (confirm('Are you sure you want to delete this item?')) {
                    inventoryData = inventoryData.filter(item => item.barcode !== barcode);
                    renderInventory();
                    showNotification('Item deleted successfully');
                }
            }
            
            // Simulate camera error for demonstration
            function showCameraError() {
                cameraError.classList.remove('hidden');
                scanAnimation.style.display = 'none';
                isScanning = false;
            }
            
            // Start camera function
            function startCamera() {
                // This would normally access the device camera
                // For this example, we'll simulate an error 30% of the time
                if (Math.random() < 0.3) {
                    showCameraError();
                } else {
                    cameraError.classList.add('hidden');
                    scanAnimation.style.display = 'block';
                    isScanning = true;
                    showNotification('Camera started successfully');
                }
            }
            
            // Stop camera function
            function stopCamera() {
                isScanning = false;
                scanAnimation.style.display = 'none';
                showNotification('Camera stopped');
            }
            
            // Toggle between IN and OUT modes
            function toggleMode() {
                isInMode = !isInMode;
                modeText.textContent = isInMode ? 'IN' : 'OUT';
                modeAction.textContent = isInMode ? 'increase' : 'decrease';
                
                // Update mode indicator
                modeIndicator.className = 'mode-indicator ' + (isInMode ? 'mode-in' : 'mode-out');
                modeIndicator.textContent = isInMode ? 'INBOUND' : 'OUTBOUND';
                
                showNotification(`Mode changed to ${isInMode ? 'INBOUND' : 'OUTBOUND'}`);
            }
            
            // Generate standardized CSV data
            function generateStandardizedCSV() {
                let csv = 'barcode,name,qty,lastScan\n';
                
                inventoryData.forEach(item => {
                    csv += `"${item.barcode}","${item.name}",${item.qty},${item.lastScan}\n`;
                });
                
                return csv;
            }
            
            // Export CSV function
            function exportCSV() {
                const csv = generateStandardizedCSV();
                const blob = new Blob([csv], { type: 'text/csv' });
                const url = URL.createObjectURL(blob);
                
                const a = document.createElement('a');
                a.href = url;
                a.download = 'inventory_export.csv';
                a.click();
                
                URL.revokeObjectURL(url);
                showNotification('CSV exported successfully');
            }
            
            // Preview data function
            function previewData() {
                const csv = generateStandardizedCSV();
                previewContent.textContent = csv;
                dataPreview.classList.remove('hidden');
            }
            
            // Add item manually
            function addItemManually() {
                const barcode = prompt('Enter barcode:');
                if (!barcode) return;
                
                const name = prompt('Enter product name:') || 'Unnamed Product';
                const qty = parseInt(prompt('Enter quantity:') || '0');
                
                // Check if barcode already exists
                const existingIndex = inventoryData.findIndex(item => item.barcode === barcode);
                
                if (existingIndex !== -1) {
                    // Update existing item
                    inventoryData[existingIndex].name = name;
                    inventoryData[existingIndex].qty += isInMode ? qty : -qty;
                    if (inventoryData[existingIndex].qty < 0) inventoryData[existingIndex].qty = 0;
                    inventoryData[existingIndex].lastScan = new Date().toLocaleString();
                    showNotification('Item updated successfully');
                } else {
                    // Add new item
                    inventoryData.push({
                        barcode,
                        name,
                        qty: Math.max(0, qty),
                        lastScan: new Date().toLocaleString()
                    });
                    showNotification('Item added successfully');
                }
                
                renderInventory();
            }
            
            // Clear all data
            function clearAllData() {
                if (confirm('Are you sure you want to clear all inventory data? This cannot be undone.')) {
                    inventoryData = [];
                    renderInventory();
                    showNotification('All data cleared');
                }
            }
            
            // Event listeners for login
            loginBtn.addEventListener('click', function() {
                login(usernameInput.value, passwordInput.value);
            });
            
            logoutBtn.addEventListener('click', logout);
            
            // Demo login buttons
            demoBtns.forEach(btn => {
                btn.addEventListener('click', function() {
                    usernameInput.value = this.dataset.username;
                    passwordInput.value = this.dataset.password;
                    login(this.dataset.username, this.dataset.password);
                });
            });
            
            // Event listeners for main app
            startCameraBtn.addEventListener('click', startCamera);
            stopCameraBtn.addEventListener('click', stopCamera);
            toggleModeBtn.addEventListener('click', toggleMode);
            retryCameraBtn.addEventListener('click', startCamera);
            exportCsvBtn.addEventListener('click', exportCSV);
            previewDataBtn.addEventListener('click', previewData);
            manualAddBtn.addEventListener('click', addItemManually);
            clearDataBtn.addEventListener('click', clearAllData);
            searchInventory.addEventListener('input', renderInventory);
            
            // Simulate periodic barcode scanning when camera is active
            setInterval(() => {
                if (isScanning && Math.random() > 0.7) {
                    const now = Date.now();
                    // Prevent multiple scans of the same barcode within the cooldown period
                    if (now - lastScannedTime < scanCooldown) return;
                    
                    lastScannedTime = now;
                    
                    // Simulate scanning a random item from inventory
                    const randomItem = inventoryData[Math.floor(Math.random() * inventoryData.length)];
                    if (randomItem) {
                        // Update quantity based on mode
                        randomItem.qty += isInMode ? 1 : -1;
                        if (randomItem.qty < 0) randomItem.qty = 0;
                        randomItem.lastScan = new Date().toLocaleString();
                        
                        renderInventory();
                        showNotification(`Scanned: ${randomItem.name} (${isInMode ? '+' : '-'}1)`);
                    }
                }
            }, 1000);
        });
    </script>
</body>
</html>
