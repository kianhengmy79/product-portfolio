# We'll also create a downloadable HTML file for the user.
html_content = """<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Warehouse Scanner — Inventory Auto-Update</title>
  <script src="https://cdn.tailwindcss.com"></script>
  <link rel="icon" href="data:," />
  <meta name="theme-color" content="#0ea5e9" />
  <style>
    /* Hide number input arrows */
    input[type=number]::-webkit-outer-spin-button,
    input[type=number]::-webkit-inner-spin-button { -webkit-appearance: none; margin: 0; }
    input[type=number] { -moz-appearance: textfield; }
    #video { transform: scaleX(-1); } /* mirror for easier aiming */
    .badge {  }
  </style>
</head>
<body class="bg-slate-50 text-slate-800">
  <div class="max-w-7xl mx-auto p-4 md:p-6">
    <header class="flex items-center gap-3 mb-4">
      <div class="w-10 h-10 rounded-2xl bg-sky-100 grid place-items-center"><span class="text-sky-600 font-bold">WS</span></div>
      <div>
        <h1 class="text-2xl md:text-3xl font-bold">Warehouse Scanner</h1>
        <p class="text-sm text-slate-500 -mt-1">Scan barcodes • Auto-update inventory • Works offline (local)</p>
      </div>
      <div class="ml-auto flex items-center gap-2">
        <span id="modeBadge" class="badge bg-emerald-100 text-emerald-700">Mode: IN</span>
        <span id="status" class="text-xs text-slate-500">Idle</span>
      </div>
    </header>

    <section class="grid lg:grid-cols-[520px_1fr] gap-6">
      <!-- Scanner Pane -->
      <div class="space-y-4">
        <div class="bg-white rounded-2xl shadow p-4">
          <div class="flex items-center gap-2 mb-3">
            <button id="startBtn" class="px-3 py-2 rounded-xl bg-sky-600 text-white font-medium shadow hover:bg-sky-700">Start Scan</button>
            <button id="stopBtn" class="px-3 py-2 rounded-xl bg-slate-200 font-medium hover:bg-slate-300">Stop</button>
            <button id="toggleModeBtn" class="px-3 py-2 rounded-xl bg-emerald-600 text-white font-medium shadow hover:bg-emerald-700">Toggle IN/OUT</button>
            <label class="ml-auto text-sm text-slate-600 flex items-center gap-2">Qty
              <input id="qtyStep" type="number" value="1" min="1" class="w-16 px-2 py-1 rounded-lg border border-slate-300" />
            </label>
          </div>
          <div class="aspect-video bg-slate-100 rounded-xl overflow-hidden grid place-items-center">
            <video id="video" class="w-full h-full object-cover"></video>
            <canvas id="overlay" class="absolute opacity-70"></canvas>
          </div>
          <div class="flex items-center gap-2 mt-3">
            <select id="cameraSelect" class="px-3 py-2 rounded-xl border border-slate-300 bg-white w-full"></select>
            <button id="torchBtn" class="px-3 py-2 rounded-xl bg-slate-200 font-medium hover:bg-slate-300">Toggle Torch</button>
          </div>
          <div class="mt-3 grid grid-cols-1 md:grid-cols-2 gap-2">
            <input id="manualInput" placeholder="Manual barcode entry…" class="px-3 py-2 rounded-xl border border-slate-300" />
            <button id="manualSubmit" class="px-3 py-2 rounded-xl bg-slate-800 text-white font-medium hover:bg-black">Submit Manual</button>
          </div>
        </div>

        <div class="bg-white rounded-2xl shadow p-4 space-y-3">
          <h2 class="font-semibold">Import / Export</h2>
          <div class="grid md:grid-cols-2 gap-2">
            <div class="flex items-center gap-2">
              <input id="csvFile" type="file" accept=".csv" class="block w-full text-sm text-slate-600" />
              <button id="importBtn" class="px-3 py-2 rounded-xl bg-slate-200 font-medium hover:bg-slate-300">Import CSV</button>
            </div>
            <div class="flex items-center gap-2">
              <button id="exportInvBtn" class="px-3 py-2 rounded-xl bg-sky-600 text-white font-medium hover:bg-sky-700 w-full">Export Inventory CSV</button>
              <button id="exportLogBtn" class="px-3 py-2 rounded-xl bg-slate-800 text-white font-medium hover:bg-black w-full">Export Log CSV</button>
            </div>
          </div>
          <p class="text-xs text-slate-500">CSV format: <code>barcode, name, qty</code>. Extra columns are ignored.</p>
        </div>

        <div class="bg-white rounded-2xl shadow p-4 flex items-center gap-2">
          <button id="undoBtn" class="px-3 py-2 rounded-xl bg-amber-500 text-white font-medium hover:bg-amber-600">Undo Last</button>
          <button id="clearBtn" class="px-3 py-2 rounded-xl bg-rose-600 text-white font-medium hover:bg-rose-700">Clear Inventory</button>
          <button id="resetBtn" class="ml-auto px-3 py-2 rounded-xl bg-slate-200 font-medium hover:bg-slate-300">Reset App</button>
        </div>
      </div>

      <!-- Inventory Pane -->
      <div class="bg-white rounded-2xl shadow p-4">
        <div class="flex flex-col md:flex-row md:items-center gap-2 mb-3">
          <div class="relative flex-1">
            <input id="search" placeholder="Search name or barcode…" class="w-full px-3 py-2 rounded-xl border border-slate-300" />
          </div>
          <div class="flex items-center gap-2">
            <button id="addItemBtn" class="px-3 py-2 rounded-xl bg-slate-200 font-medium hover:bg-slate-300">Add Item</button>
            <span class="text-sm text-slate-500">Total SKUs: <span id="skuCount">0</span></span>
          </div>
        </div>
        <div class="overflow-auto rounded-xl border border-slate-200">
          <table class="min-w-full text-sm">
            <thead class="bg-slate-50 text-slate-600">
              <tr>
                <th class="text-left p-3">Barcode</th>
                <th class="text-left p-3">Name</th>
                <th class="text-right p-3">Qty</th>
                <th class="text-left p-3">Last Scan</th>
                <th class="text-left p-3">Actions</th>
              </tr>
            </thead>
            <tbody id="tbody"></tbody>
          </table>
        </div>
      </div>
    </section>

    <footer class="text-center text-xs text-slate-400 mt-6">Data is stored locally in your browser (IndexedDB). Use exports for backups.</footer>
  </div>

  <!-- ZXing fallback (only loaded if needed) -->
  <script id="zxingScript" defer src="" ></script>

  <script>
  // ====== Utilities ======
  const $ = (sel) => document.querySelector(sel);
  const fmtDateTime = (d = new Date()) => d.toLocaleString();
  const sleep = (ms) => new Promise(r => setTimeout(r, ms));

  // ====== Persistent Storage (IndexedDB) ======
  const DB_NAME = 'warehouse-scanner-db';
  const DB_VER = 1;
  let db;

  function openDB() {
    return new Promise((resolve, reject) => {
      const req = indexedDB.open(DB_NAME, DB_VER);
      req.onupgradeneeded = () => {
        const db = req.result;
        if (!db.objectStoreNames.contains('inventory')) {
          const inv = db.createObjectStore('inventory', { keyPath: 'barcode' });
          inv.createIndex('name', 'name', { unique: false });
        }
        if (!db.objectStoreNames.contains('log')) {
          db.createObjectStore('log', { keyPath: 'id', autoIncrement: true });
        }
      };
      req.onsuccess = () => resolve(req.result);
      req.onerror = () => reject(req.error);
    });
  }

  async function tx(store, mode, fn) {
    return new Promise((resolve, reject) => {
      const t = db.transaction(store, mode);
      const s = t.objectStore(store);
      const r = fn(s);
      t.oncomplete = () => resolve(r);
      t.onerror = () => reject(t.error);
    });
  }

  async function getAll(store) {
    return new Promise((resolve, reject) => {
      const req = db.transaction(store).objectStore(store).getAll();
      req.onsuccess = () => resolve(req.result);
      req.onerror = () => reject(req.error);
    });
  }

  // ====== State ======
  let MODE_IN = true; // true = IN, false = OUT
  let currentStream = null;
  let currentTrack = null;
  let scanning = false;
  let lastAction = null; // {barcode, delta}

  const statusEl = $('#status');
  const modeBadge = $('#modeBadge');

  function setStatus(msg) { statusEl.textContent = msg; }
  function setModeBadge() {
    modeBadge.textContent = `Mode: ${MODE_IN ? 'IN' : 'OUT'}`;
    modeBadge.className = 'badge ' + (MODE_IN ? 'bg-emerald-100 text-emerald-700' : 'bg-rose-100 text-rose-700');
  }

  function beep() {
    try {
      const ctx = new (window.AudioContext || window.webkitAudioContext)();
      const o = ctx.createOscillator();
      const g = ctx.createGain();
      o.type = 'square';
      o.frequency.value = 880;
      o.connect(g); g.connect(ctx.destination);
      o.start();
      g.gain.exponentialRampToValueAtTime(0.0001, ctx.currentTime + 0.15);
      setTimeout(() => { o.stop(); ctx.close(); }, 170);
    } catch(e) {}
  }

  // ====== Inventory Ops ======
  async function upsertItem({ barcode, name = '', qty = 0 }) {
    await tx('inventory', 'readwrite', (s) => s.put({ barcode, name, qty, lastScan: null }));
  }

  async function adjustQty(barcode, delta) {
    await tx('inventory', 'readwrite', (s) => {
      const req = s.get(barcode);
      req.onsuccess = () => {
        const item = req.result || { barcode, name: '', qty: 0, lastScan: null };
        item.qty = Math.max(0, (item.qty || 0) + delta);
        item.lastScan = new Date().toISOString();
        s.put(item);
        lastAction = { barcode, delta };
        renderTable();
      };
    });
    await tx('log', 'readwrite', (s) => s.add({ ts: new Date().toISOString(), barcode, delta }));
  }

  async function undoLast() {
    if (!lastAction) return;
    const { barcode, delta } = lastAction;
    await adjustQty(barcode, -delta);
    lastAction = null;
  }

  async function removeItem(barcode) {
    await tx('inventory', 'readwrite', (s) => s.delete(barcode));
    renderTable();
  }

  function parseCSV(text) {
    const rows = text.split(/\\r?\\n/).map(r => r.trim()).filter(Boolean);
    const out = [];
    for (const r of rows) {
      const [barcode, name, qty] = r.split(',');
      if (!barcode) continue;
      out.push({ barcode: barcode.trim(), name: (name||'').trim(), qty: Number(qty||0) });
    }
    return out;
  }

  async function importCSV(text) {
    const items = parseCSV(text);
    for (const it of items) { await upsertItem(it); }
    renderTable();
  }

  async function exportInventoryCSV() {
    const items = await getAll('inventory');
    const rows = [['barcode','name','qty','lastScan'], ...items.map(i => [i.barcode, i.name||'', i.qty||0, i.lastScan||''])];
    downloadCSV(rows, `inventory-${new Date().toISOString().slice(0,10)}.csv`);
  }

  async function exportLogCSV() {
    const items = await getAll('log');
    const rows = [['id','ts','barcode','delta'], ...items.map((i, idx) => [idx+1, i.ts, i.barcode, i.delta])];
    downloadCSV(rows, `scanlog-${new Date().toISOString().slice(0,10)}.csv`);
  }

  function downloadCSV(rows, filename) {
    const csv = rows.map(r => r.map(v => '"' + String(v).replaceAll('"','""') + '"').join(',')).join('\\n');
    const blob = new Blob([csv], { type: 'text/csv;charset=utf-8;' });
    const a = document.createElement('a');
    a.href = URL.createObjectURL(blob);
    a.download = filename; a.click();
    URL.revokeObjectURL(a.href);
  }

  // ====== Rendering ======
  async function renderTable() {
    const q = $('#search').value.toLowerCase();
    const items = await getAll('inventory');
    items.sort((a,b) => (b.lastScan||'').localeCompare(a.lastScan||''));
    const filtered = items.filter(i => (i.barcode+ ' ' + (i.name||'')).toLowerCase().includes(q));
    $('#skuCount').textContent = String(items.length);
    const tbody = $('#tbody');
    tbody.innerHTML = '';
    for (const it of filtered) {
      const tr = document.createElement('tr');
      tr.className = 'border-t border-slate-100 hover:bg-slate-50';
      tr.innerHTML = `
        <td class="p-3 font-mono text-xs">${it.barcode}</td>
        <td class="p-3">
          <input data-bc="${it.barcode}" class="nameInput w-full bg-transparent outline-none" value="${(it.name||'').replaceAll('"','&quot;')}" />
        </td>
        <td class="p-3 text-right font-semibold tabular-nums">${it.qty||0}</td>
        <td class="p-3 text-xs text-slate-500">${it.lastScan ? fmtDateTime(new Date(it.lastScan)) : '-'}</td>
        <td class="p-3 flex items-center gap-2">
          <button data-bc="${it.barcode}" class="inc px-2 py-1 rounded-lg bg-slate-200">+1</button>
          <button data-bc="${it.barcode}" class="dec px-2 py-1 rounded-lg bg-slate-200">-1</button>
          <button data-bc="${it.barcode}" class="del px-2 py-1 rounded-lg bg-rose-600 text-white">Delete</button>
        </td>`;
      tbody.appendChild(tr);
    }

    // Wire row controls
    tbody.querySelectorAll('.inc').forEach(b=>b.onclick = () => adjustQty(b.dataset.bc, +1));
    tbody.querySelectorAll('.dec').forEach(b=>b.onclick = () => adjustQty(b.dataset.bc, -1));
    tbody.querySelectorAll('.del').forEach(b=>b.onclick = async () => {
      if (confirm('Delete this SKU?')) await removeItem(b.dataset.bc);
    });
    tbody.querySelectorAll('.nameInput').forEach(inp => {
      inp.onchange = async () => {
        await tx('inventory','readwrite', s => {
          const req = s.get(inp.dataset.bc);
          req.onsuccess = () => {
            const it = req.result; it.name = inp.value; s.put(it);
          };
        });
      };
    });
  }

  // ====== Scanner ======
  let barcodeDetector = null;
  let zxingReader = null;
  let rafId = null;

  async function listCameras() {
    const devices = await navigator.mediaDevices.enumerateDevices();
    const cams = devices.filter(d => d.kind === 'videoinput');
    const sel = $('#cameraSelect');
    sel.innerHTML = cams.map((c,i) => `<option value="${c.deviceId}">${c.label || 'Camera ' + (i+1)}</option>`).join('');
  }

  async function startScan() {
    try {
      await stopScan();
      const deviceId = $('#cameraSelect').value || undefined;
      const constraints = { video: { deviceId: deviceId ? { exact: deviceId } : undefined, facingMode: 'environment' }, audio: false };
      currentStream = await navigator.mediaDevices.getUserMedia(constraints);
      const video = $('#video');
      video.srcObject = currentStream;
      await video.play();
      currentTrack = currentStream.getVideoTracks()[0];
      scanning = true;
      setStatus('Scanning…');

      if ('BarcodeDetector' in window) {
        const formats = ['ean_13','ean_8','code_128','qr_code','upc_e','upc_a','code_39','codabar'];
        barcodeDetector = new window.BarcodeDetector({ formats });
        loopBarcodeDetector();
      } else {
        await loadZXing();
        zxingReader = new ZXing.BrowserMultiFormatReader();
        loopZXing();
      }
    } catch (e) {
      console.error(e);
      alert('Camera error: ' + e.message);
      setStatus('Camera error');
    }
  }

  async function stopScan() {
    scanning = false;
    if (rafId) cancelAnimationFrame(rafId);
    if (currentTrack) { try { currentTrack.stop(); } catch(_){} currentTrack = null; }
    if (currentStream) { currentStream.getTracks().forEach(t=>t.stop()); currentStream = null; }
    setStatus('Idle');
  }

  async function loopBarcodeDetector() {
    const video = $('#video');
    const canvas = $('#overlay');
    const ctx = canvas.getContext('2d');
    const step = async () => {
      if (!scanning) return;
      if (video.readyState >= 2) {
        canvas.width = video.videoWidth; canvas.height = video.videoHeight;
        try {
          const codes = await barcodeDetector.detect(video);
          ctx.clearRect(0,0,canvas.width, canvas.height);
          if (codes && codes.length) {
            const val = codes[0].rawValue;
            drawBox(ctx, codes[0].boundingBox);
            onBarcode(val);
            await sleep(500);
          }
        } catch (e) { /* ignore */ }
      }
      rafId = requestAnimationFrame(step);
    };
    step();
  }

  function drawBox(ctx, box) {
    if (!box) return;
    ctx.lineWidth = 3; ctx.strokeStyle = 'lime';
    ctx.strokeRect(box.x, box.y, box.width, box.height);
  }

  async function loadZXing() {
    return new Promise((resolve, reject) => {
      const s = document.getElementById('zxingScript');
      if (s.getAttribute('src')) return resolve();
      s.onload = () => resolve();
      s.onerror = () => reject(new Error('Failed to load ZXing fallback'));
      s.src = 'https://unpkg.com/@zxing/library@0.21.2/esm/index.min.js';
    });
  }

  async function loopZXing() {
    const video = $('#video');
    const canvas = $('#overlay');
    const ctx = canvas.getContext('2d');
    const step = async () => {
      if (!scanning) return;
      if (video.readyState >= 2) {
        canvas.width = video.videoWidth; canvas.height = video.videoHeight;
        try {
          const result = await zxingReader.decodeOnceFromVideoElement(video);
          ctx.clearRect(0,0,canvas.width, canvas.height);
          if (result && result.text) {
            onBarcode(result.text);
            await sleep(500);
          }
        } catch (e) { /* keep trying */ }
      }
      rafId = requestAnimationFrame(step);
    };
    step();
  }

  async function onBarcode(code) {
    const qty = Math.max(1, Number($('#qtyStep').value||1));
    const delta = MODE_IN ? qty : -qty;
    setStatus((MODE_IN ? 'IN +' : 'OUT ') + qty + ' → ' + code);
    beep();
    await adjustQty(code, delta);
  }

  // Torch toggle
  async function toggleTorch() {
    if (!currentTrack) return alert('Start the camera first.');
    const caps = currentTrack.getCapabilities?.();
    if (!caps || !caps.torch) return alert('Torch not supported on this device.');
    const settings = currentTrack.getSettings();
    const torchOn = !settings.torch;
    await currentTrack.applyConstraints({ advanced: [{ torch: torchOn }] });
  }

  // ====== Events ======
  $('#startBtn').onclick = startScan;
  $('#stopBtn').onclick = stopScan;
  $('#toggleModeBtn').onclick = () => { MODE_IN = !MODE_IN; setModeBadge(); };
  $('#torchBtn').onclick = toggleTorch;
  $('#manualSubmit').onclick = async () => {
    const v = $('#manualInput').value.trim();
    if (!v) return; await onBarcode(v); $('#manualInput').value='';
  };
  $('#manualInput').addEventListener('keydown', (e) => { if (e.key === 'Enter') $('#manualSubmit').click(); });

  $('#importBtn').onclick = async () => {
    const f = $('#csvFile').files?.[0];
    if (!f) return alert('Choose a CSV file.');
    const text = await f.text();
    await importCSV(text);
  };

  $('#exportInvBtn').onclick = exportInventoryCSV;
  $('#exportLogBtn').onclick = exportLogCSV;
  $('#undoBtn').onclick = undoLast;
  $('#clearBtn').onclick = async () => {
    if (!confirm('Clear ALL inventory?')) return;
    await tx('inventory','readwrite', s => s.clear());
    await tx('log','readwrite', s => s.clear());
    renderTable();
  };
  $('#resetBtn').onclick = async () => {
    if (!confirm('Reset app (delete DB)?')) return;
    await stopScan();
    const req = indexedDB.deleteDatabase(DB_NAME);
    req.onsuccess = () => location.reload();
  };

  $('#search').oninput = renderTable;
  $('#addItemBtn').onclick = async () => {
    const barcode = prompt('Barcode?'); if (!barcode) return;
    const name = prompt('Name (optional)') || '';
    const qty = Number(prompt('Qty (default 0)') || 0) || 0;
    await upsertItem({ barcode, name, qty });
    renderTable();
  };

  $('#cameraSelect').onchange = () => { if (scanning) startScan(); };

  // ====== Init ======
  (async function init(){
    db = await openDB();
    setModeBadge();
    await listCameras().catch(()=>{});
    await renderTable();
  })();

  // ====== Keyboard shortcuts ======
  window.addEventListener('keydown', (e) => {
    if (e.key === 'F2') $('#toggleModeBtn').click(); // toggle IN/OUT
    if (e.key === 'F8') $('#startBtn').click();
    if (e.key === 'F9') $('#stopBtn').click();
  });
  </script>
</body>
</html>
"""
path = "/mnt/data/warehouse_scanner.html"
with open(path, "w", encoding="utf-8") as f:
    f.write(html_content)
path
